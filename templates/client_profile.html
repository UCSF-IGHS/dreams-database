{% extends 'base.html' %}

{% block content %}

    {% include 'includes/enrollment_form.html' %}

    <!-- Beginning modal-->
        <!-- Modal -->
    <div class="modal fade" id="intervention-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         xmlns="http://www.w3.org/1999/html">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="exampleModalLabel">NEW INTERVENTION</h4>
                    <h5>For: {{ client.first_name }} {{ client.last_name }}</h5>
              </div>
              <div class="modal-body">
                <form id="intervention-entry-form">
                    {% csrf_token %}
                    <!-- Permanently hidden Fields -->

                    <input class="hidden validate-intervention-form-field" name="client" value="{{ client.id }}"/>
                    <input class="hidden validate-intervention-form-field" name="created_by" value="{{ user.id }}"/>
                    <input class="hidden validate-intervention-form-field" name="intervention_id" id="intervention_id" value=""/>
                    <input class="hidden validate-intervention-form-field" name="changed_by" id="changed_by" value="{{ user.id }}"/>

                    <!-- End of Permanently hidden fields -->

                    <div class="form-group">
                      <label for="intervention-type-select">Intervention Type</label>
                      <select id="intervention-type-select" name="intervention_type_code" class="form-control validate-intervention-form-field" >
                      </select>
                    </div>


                    <div class="form-group has-feedback hidden" id="intervention_date_section">
                        <label for="date-of-completion" class="control-label">Date of Completion:</label>
                        <input type="text" class="form-control validate-intervention-form-field" id="date-of-completion"  placeholder="Select date of completion" style="cursor: pointer;"><span class="add-on"><i class="icon-th"></i></span></p>
                        <input type="text" class="form-control validate-intervention-form-field hidden" id="date-of-completion-formatted" name="intervention_date"/>
                        <i class="glyphicon glyphicon-calendar form-control-feedback"></i>
                      <script>
                          $(function() {
                            $( "#date-of-completion" ).datepicker();
                          });
                      </script>
                    </div>


                    <div class="form-group hidden" id="hts_result_section">
                      <label for="intervention-type-select">HTS Test Result</label>
                      <select id="hts-result-select" name="hts_result" class="form-control validate-intervention-form-field">
                          <option value="">Select Option</option>
                          <option value="201">Negative</option>
                          <option value="202">Positive</option>
                          <option value="203">Known Positive</option>
                          <option value="204">Linked to HTS</option>
                      </select>
                    </div>


                    <div class="form-group hidden" id="ccc_number_section">
                        <label for="ccc-number" class="control-label">CCC Number</label>
                        <input type="text" class="form-control validate-intervention-form-field" id="ccc-number" name="client_ccc_number"></input>
                    </div>

                    <div class="form-group hidden" id="pregnancy_test_section">
                      <label for="intervention-type-select">Pregnancy Test Result</label>
                      <select id="pregnancy-result-select" name="pregnancy_test_result" class="form-control validate-intervention-form-field">
                          <option value="">Select Option</option>
                          <option value="102">Not Pregnant</option>
                          <option value="102">Pregnant</option>
                          <option value="103">Linked to HTS</option>
                      </select>
                    </div>

                    <div class="form-group hidden" id="no_of_sessions_section">
                        <label for="number-of-ss-sessions-attended" class="control-label">Number of SS Sessions Attended</label>
                        <input type="number" class="form-control validate-intervention-form-field" id="number-of-ss-sessions-attended" name="no_of_sessions_attended"></input>
                    </div>

                    <div class="form-group hidden" id="notes_section">
                       <label for="comments-text" class="control-label">Comments/Notes</label>
                       <textarea class="form-control validate-intervention-form-field" id="comments-text" name="comment"></textarea>
                    </div>

                    <div class="form-group" id="notes_section">
                        <span id="error-space" class="label" style="color: red;"></span>
                    </div>

                    Updated by <strong>{{ user.first_name }} {{ user.last_name }}</strong> on {% now "d-m-Y" %}
                </form>
              </div>
              <div class="modal-footer">
                <button id="btn_cancel_intervention" type="button" class="btn btn-default" data-dismiss="modal"> Cancel </button>
                <button id="btn_save_intervention" type="button" class="btn btn-primary" > Save Intervention </button>
              </div>
            </div>
          </div>
    </div>
    <!-- End modal-->

    <!-- Beginning Confirm Delete Modal -->

    <div class="modal fade" id="confirm-delete-mordal" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Confirm Intervention Delete Action</h4>
          </div>
          <div class="modal-body">
              <form method="POST" action="#" id="intervention_delete_form">
                  {% csrf_token %}
                  <p>Are you sure you want to delete this Intervention entry? Changes cannot be undone.</p>
                  <input type="hidden" name="intervention_delete_id" id="intervention_delete_id" value=""/>
              </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal"> Cancel </button>
            <button type="button" class="btn btn-danger" id="btn_delete_intervention_confirmation">Delete Intervention</button>
          </div>
        </div>
      </div>
    </div>

    <!-- End Confirm Delete Modal -->

    <!-- Client profile section -->
    <div class="row search-section" style="margin: 0px 15px !important;">
        <div class="col-xs-12 col-sm-5">
            <p><strong>Client: </strong> {{ client }} </p>
            <p><strong>Date Enrolled: </strong> {{ client.date_of_enrollment }}</p>
            {% if user.is_superuser %}
            <p style="cursor:pointer;" data-toggle="tooltip" title="Edit Enrollment">
                <span class="label label-info tags edit_client" data-toggle="modal" data-target="#enrollment-modal" data-client_id='{{ client.id }}'><span class="glyphicon glyphicon-pencil"></span> Edit Enrollment</span>
            </p>
            {% endif %}
        </div><!--/col-->
        <div class="col-xs-12 col-sm-4">
            <p><strong>DREAMS Id: </strong> {{ client.dreams_id }}</p>
             <p><strong>Phone Number: </strong>
                <span>{{ client.phone_number }} {% if client.guardian_phone_number != None and client.guardian_phone_number != '' %}(Guardian){{ client.guardian_phone_number }}{% endif %}</span>
            </p>
        </div><!--/col-->
        <div class="col-xs-12 col-sm-3">

        </div><!--/col-->
    </div>
    <!-- End of Client profile section -->
    <div class="row dp-margin" id="client_profile_tab_control">
        <ul class="nav nav-tabs">
            <li role="presentation"><a href="#behavioural-interventions" aria-controls="behavioural-interventions" role="tab" data-toggle="tab" data-intervention_category_code="1001" data-tab_intervention_table_id="#interventions_1001_table">Behavioural</a></li>
            <li role="presentation"><a href="#biomedical-interventions" aria-controls="biomedical-interventions" role="tab" data-toggle="tab" data-intervention_category_code="2001" data-tab_intervention_table_id="#interventions_2001_table">Bio-medical</a></li>
            <li role="presentation"><a href="#post-gbv-care" aria-controls="post-gbv-care" role="tab" data-toggle="tab" data-intervention_category_code="3001" data-tab_intervention_table_id="#interventions_3001_table">Post-GVB Care</a></li>
            <li role="presentation"><a href="#social-protection" aria-controls="social-protection" role="tab" data-toggle="tab" data-intervention_category_code="4001" data-tab_intervention_table_id="#interventions_4001_table">Social protection</a></li>
            <li role="presentation"><a href="#other-interventions" aria-controls="other-interventions" role="tab" data-toggle="tab" data-intervention_category_code="5001" data-tab_intervention_table_id="#interventions_5001_table">Other</a></li>
            <li style="float: right;"><a class="no-hover" href="/clients/"><span class="glyphicon glyphicon-triangle-left"> </span> Back to Clients</a> </li>
        </ul>

        <div class="tab-content" >
            <br/>
            <div role="tabpanel" id="behavioural-interventions" class="tab-pane fade in active client_profile_tab" data-tabpanel_id="#behavioural-interventions" data-intervention_category_code="1001">

               <table class="fit-item space" >
                  <thead>
                      <tr>
                          <th style="padding-right: 10px;">
                              <div class="input-group"> <span class="input-group-addon btn btn-primary" style="color: #FFFFFF;">Filter</span>
                                <input id="filter_1001" data-target_tbody="#interventions_1001_tbody" data-intervention_category_code="1001" data-tab_intervention_table_id="#interventions_1001_table" type="text" class="form-control filter" placeholder="Type to search..." >
                              </div>
                          </th>
                          <th><button class="btn btn-default" data-toggle="modal" data-target="#intervention-modal" data-whatever="1001" ><i class="glyphicon glyphicon-plus text-success"></i> Intervention</button></th>
                      </tr>
                  </thead>
               </table>

               <div class="alert hidden dp-action-alert" id="action_alert_1001" role="alert"></div>

               <div class="panel panel-default" style="padding-left: 0px; margin-left: 0px;">
                  <div class="panel-body" style="margin: 0px;padding: 0px;">

                      <table class="table table-striped" id="interventions_1001_table">
                          <thead>
                              <tr>
                                  <th>Intervention Type</th>
                                  <th>Date Completed</th>
                                  <th>Comment/Notes</th>
                                  <th>Actions</th>
                              </tr>
                          </thead>
                          <tbody class="searchable" id="interventions_1001_tbody" >
                          </tbody>
                      </table>
                      <div class="spinner hidden fit-item">
                            <i class='fa fa-spinner fa-spin'></i>
                            <p style="font-size: large">Loading interventions</p>
                      </div>
                      <div class=" hidden fit-item message-view" style="text-align: center">
                          <p style="font-size: large">0 interventions found</p>
                      </div>
                  </div>
                  </div>

            </div>

            <div role="tabpanel" id="biomedical-interventions" class="tab-pane fade client_profile_tab" data-tabpanel_id="#biomedical-interventions" data-intervention_category_code="2001">

                  <table class="fit-item space" >
                      <thead>
                          <tr>
                              <th style="padding-right: 10px;">
                                  <div class="input-group"> <span class="input-group-addon btn btn-primary" style="color: #FFFFFF;">Filter</span>
                                    <input id="filter_2001" data-target_tbody="#interventions_2001_tbody" data-intervention_category_code="2001" data-tab_intervention_table_id="#interventions_2001_table" type="text" class="form-control filter" placeholder="Type here...">
                                  </div>
                              </th>
                              <th><button class="btn btn-default" data-toggle="modal" data-target="#intervention-modal" data-whatever="2001" ><i class="glyphicon glyphicon-plus text-success"></i> Intervention</button></th>
                          </tr>
                      </thead>
                  </table>

                <div class="alert hidden dp-action-alert" id="action_alert_2001" role="alert"></div>

                <div class="panel panel-default" style="padding-left: 0px; margin-left: 0px;">
                      <div class="panel-body" style="margin: 0px;padding: 0px;">
                            <table class="table table-striped" id="interventions_2001_table">
                              <thead>
                                  <tr>
                                      <th>Intervention Type</th>
                                      <th>Date Tested/ Linked to CCC</th>
                                      <th>Test Result</th>
                                      <th>CCC Number</th>
                                      <th>Comment/Notes</th>
                                      <th>Actions</th>
                                  </tr>
                              </thead>
                              <tbody class="searchable" id="interventions_2001_tbody">
                              </tbody>
                            </table>
                            <div class="spinner hidden fit-item">
                                <i class='fa fa-spinner fa-spin'></i>
                                <p style="font-size: large">Loading interventions</p>
                            </div>
                            <div class=" hidden fit-item message-view" style="text-align: center">
                                <p style="font-size: large">0 interventions found</p>
                            </div>
                      </div>
                  </div>
            </div>

            <div role="tabpanel" id="post-gbv-care" class="tab-pane fade client_profile_tab" data-tabpanel_id="#post-gbv-care" data-intervention_category_code="3001">

                  <table class="fit-item space">
                      <thead>
                          <tr>
                              <th style="padding-right: 10px;">
                                  <div class="input-group"> <span class="input-group-addon btn btn-primary" style="color: #FFFFFF;">Filter</span>
                                    <input id="filter_3001" data-target_tbody="#interventions_3001_tbody" data-intervention_category_code="3001" data-tab_intervention_table_id="#interventions_3001_table" type="text" class="form-control filter" placeholder="Type here...">
                                  </div>
                              </th>
                              <th><button class="btn btn-default" data-toggle="modal" data-target="#intervention-modal" data-whatever="3001" ><i class="glyphicon glyphicon-plus text-success"></i> Intervention</button></th>
                          </tr>
                      </thead>
                  </table>

                <div class="alert hidden dp-action-alert" id="action_alert_3001" role="alert"></div>

                <div class="panel panel-default" style="padding-left: 0px; margin-left: 0px;">
                    <div class="panel-body" style="margin: 0px;padding: 0px;">
                      <table class="table table-striped" id="interventions_3001_table">
                          <thead>
                              <tr>
                                  <th>Intervention Type</th>
                                  <th>Date Given</th>
                                  <th>Comment/Notes</th>
                                  <th>Actions</th>
                              </tr>
                         </thead>
                         <tbody class="searchable" id="interventions_3001_tbody">

                         </tbody>
                      </table>
                      <div class="spinner hidden fit-item">
                        <i class='fa fa-spinner fa-spin'></i>
                        <p style="font-size: large">Loading interventions</p>
                      </div>
                      <div class=" hidden fit-item message-view" style="text-align: center">
                        <p style="font-size: large">0 interventions found</p>
                      </div>
                   </div>
               </div>
            </div>

            <div role="tabpanel" id="social-protection" class="tab-pane fade client_profile_tab" data-tabpanel_id="#social-protection" data-intervention_category_code="4001">

                  <table class="fit-item space" >
                      <thead>
                          <tr>
                              <th style="padding-right: 10px;">
                                  <div class="input-group"> <span class="input-group-addon btn btn-primary" style="color: #FFFFFF;">Filter</span>
                                    <input id="filter_4001" data-target_tbody="#interventions_4001_tbody" data-intervention_category_code="4001" data-tab_intervention_table_id="#interventions_4001_table" type="text" class="form-control filter" placeholder="Type here...">
                                  </div>
                              </th>
                              <th><button class="btn btn-default" data-toggle="modal" data-target="#intervention-modal" data-whatever="4001" ><i class="glyphicon glyphicon-plus text-success"></i> Intervention</button></th>
                          </tr>
                      </thead>
                  </table>

                <div class="alert hidden dp-action-alert" id="action_alert_4001" role="alert"></div>

                  <div class="panel panel-default" style="padding-left: 0px; margin-left: 0px;">
                      <div class="panel-body" style="margin: 0px;padding: 0px;">
                          <table class="table table-striped" id="interventions_4001_table">
                              <thead>
                                  <tr>
                                      <th>Intervention Type</th>
                                      <th>Date Completed</th>
                                      <th>Comment/Notes</th>
                                      <th>Actions</th>
                                  </tr>
                             </thead>
                             <tbody class="searchable" id="interventions_4001_tbody">

                             </tbody>
                          </table>
                          <div class="spinner hidden fit-item">
                                <i class='fa fa-spinner fa-spin'></i>
                                <p style="font-size: large">Loading interventions</p>
                            </div>
                            <div class=" hidden fit-item message-view" style="text-align: center">
                                <p style="font-size: large">0 interventions found</p>
                            </div>
                      </div>
                  </div>

              </div>

            <div role="tabpanel" id="other-interventions" class="tab-pane fade client_profile_tab" data-tabpanel_id="#other-interventions" data-intervention_category_code="5001">

                  <table class="fit-item space" >
                      <thead>
                          <tr>
                              <th style="padding-right: 10px;">
                                  <div class="input-group"> <span class="input-group-addon btn btn-primary" style="color: #FFFFFF;">Filter</span>
                                    <input id="filter_5001" data-target_tbody="#interventions_5001_tbody" data-intervention_category_code="5001" data-tab_intervention_table_id="#interventions_5001_table" type="text" class="form-control filter" placeholder="Type here...">
                                  </div>
                              </th>
                              <th><button class="btn btn-default" data-toggle="modal" data-target="#intervention-modal" data-whatever="5001" ><i class="glyphicon glyphicon-plus text-success"></i> Intervention</button></th>
                          </tr>
                      </thead>
                  </table>

                <div class="alert hidden dp-action-alert" id="action_alert_5001" role="alert"></div>

                  <div class="panel panel-default" style="padding-left: 0px; margin-left: 0px;">
                      <div class="panel-body" style="margin: 0px;padding: 0px;">
                          <table class="table table-striped" id="interventions_5001_table">
                              <thead>
                                  <tr>
                                      <th>Intervention Type</th>
                                      <th>Date Completed</th>
                                      <th>Number of SS Sessions Attended</th>
                                      <th>Comment/Notes</th>
                                      <th>Actions</th>
                                  </tr>
                             </thead>
                             <tbody class="searchable" id="interventions_5001_tbody">
                             </tbody>
                          </table>
                          <div class="spinner hidden fit-item">
                                <i class='fa fa-spinner fa-spin'></i>
                                <p style="font-size: large">Loading interventions</p>
                            </div>
                            <div class=" hidden fit-item message-view" style="text-align: center">
                                <p style="font-size: large">0 interventions found</p>
                            </div>
                      </div>
                  </div>

              </div>

        </div>
    </div>

    <input id="current_client_id" class="hidden" type="text" name="client_id" value="{{ client.id }}">
{% endblock %}