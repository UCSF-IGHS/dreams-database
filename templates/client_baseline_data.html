{% extends 'base.html' %}

{% block content %}
    {% include 'includes/client_exit_form.html' %}
    {% include 'includes/client_unexit_form.html' %}
    {% include 'includes/client_transfer_form.html' %}
    {% include 'includes/client_void_form.html' %}
    {% if client_action_permissions.can_perform_view %}
        <div class="wrapper-container enrolment-input-question">
            
        <!-- Start of Client profile section -->
        <div class=" statusBox">
            <div>
                <h4>{% if client != None %}CLIENT IMPLEMENTING PARTNER:
                    {{ client.implementing_partner.name }}{% endif %}</h4>
            </div>
            <div class="row">
                <div class="col-xs-12 col-sm-5">
                    <p><strong>Client: </strong><span id="shown_client_name"> {{ client.get_full_name }} <span
                            class="client_exit_voided_status">{{ client_status }}</span></p>
                    <p><strong>DREAMS ID: </strong><span id="shown_client_dreams_id"> {{ client.dreams_id }}</span></p>
                    <p><strong>Date Birth: </strong><span id="shown_client_dob"> {{ client.date_of_birth }}</span>
                        (Current Age <span id="shown_client_age">{{ client.get_current_age }}</span> )</p>

                </div><!--/col-->
                <div class="col-xs-12 col-sm-4">
                    <p><strong>Date Enrolled: </strong> <span id="shown_client_doe">{{ client.date_of_enrollment }} (Age at enrollment: {{ client.get_age_at_enrollment }})</span>
                    </p>
                    <p><strong>Phone Number: </strong>
                        <span id="shown_client_phone">{% if client.phone_number != None %}
                            {{ client.phone_number }}{% endif %}</span>
                    </p>
                    <p><strong>Marital status: </strong> <span
                            id="shown_client_marital_status">{{ client.marital_status }}</span></p>
                </div><!--/col-->
                <div class="col-xs-12 col-sm-3">
                {% if client_action_permissions.can_perform_edit %}
                    <p><strong>Actions: </strong> <br>

                    {% if intervention_action_permissions.can_perform_list %}
                        <p class="underline_hover" data-client_id='{{ client.id }}' style="cursor:pointer;"
                           onclick="window.location='/client?client_id={{ client.id }}&search_client_term={{ search_client_term }}'"
                           data-toggle="tooltip" title="Edit Enrollment"><span class="glyphicon glyphicon-folder-close"></span>
                            Service Uptake</p>
                    {% endif %}
                        {% if 'Transferred Out' not in client_status %}
                            {% if perms.DreamsApp.can_exit_client and current_user_belongs_to_same_ip_as_client %}
                                {% if client.exited %}
                                    <p class="underline_hover" id="p_exit_client" data-client_id='{{ client.id }}'
                                       data-search_client_term='{{ search_client_term }}' style="cursor:pointer;"
                                       data-toggle="modal" data-target="#client-unexit-modal" title="Exit Client">
                                        <span class="glyphicon glyphicon-log-out"></span> <span
                                            class="client_status_action_text">Undo Exit Client</span>
                                    </p>
                                {% else %}
                                    <p class="underline_hover" id="p_exit_client" data-client_id='{{ client.id }}'
                                       data-search_client_term='{{ search_client_term }}' style="cursor:pointer;"
                                       data-toggle="modal" data-target="#client-exit-modal" title="Exit Client">
                                        <span class="glyphicon glyphicon-log-out"></span> <span
                                            class="client_status_action_text">Exit Client</span>
                                    </p>
                                {% endif %}
                            {% endif %}
                            {% if perms.DreamsApp.add_clienttransfer %}
                                {% if client.can_be_transferred and not client.voided and not client.exited and current_user_belongs_to_same_ip_as_client %}

                                    {% if client.exited %}
                                        <p class="underline_hover" id="p_exit_client" data-client_id='{{ client.id }}'
                                           data-search_client_term='{{ search_client_term }}' style="cursor:pointer;"
                                           data-toggle="modal" data-target="#client-unexit-modal" title="Exit Client">
                                            <span class="glyphicon glyphicon-log-out"></span> <span
                                                class="client_status_action_text">Undo Exit Client</span>
                                        </p>
                                    {% else %}
                                        <p class="underline_hover" id="p_exit_client" data-client_id='{{ client.id }}'
                                           data-search_client_term='{{ search_client_term }}' style="cursor:pointer;"
                                           data-toggle="modal" data-target="#client-exit-modal" title="Exit Client">
                                            <span class="glyphicon glyphicon-log-out"></span> <span
                                                class="client_status_action_text">Exit Client</span>
                                        </p>
                                    {% endif %}
                                {% endif %}
                                {% if perms.DreamsApp.add_clienttransfer %}
                                    {% if client.can_be_transferred and not client.voided and not client.exited and current_user_belongs_to_same_ip_as_client %}
                                        {% if client.exited %}
                                            <p class="underline_hover exit_unexit_toggle" id="p_transfer_client"
                                               data-client_id='{{ client.id }}'
                                               data-search_client_term='{{ search_client_term }}'
                                               style="cursor:pointer; display: none"
                                               data-toggle="modal" data-target="#client-transfer-modal"
                                               title="Transfer Client">
                                                <span class="glyphicon glyphicon-transfer"></span> Transfer Client
                                            </p>
                                        {% else %}
                                            <p class="underline_hover exit_unexit_toggle" id="p_transfer_client"
                                               data-client_id='{{ client.id }}'
                                               data-search_client_term='{{ search_client_term }}'
                                               style="cursor:pointer;"
                                               data-toggle="modal" data-target="#client-transfer-modal"
                                               title="Transfer Client">
                                                <span class="glyphicon glyphicon-transfer"></span> Transfer Client
                                            </p>
                                        {% endif %}
                                    {% elif not client.can_be_transferred %}
                                        <p>
                                            <span>In Transfer</span>
                                        </p>
                                    {% endif %}
                                {% endif %}

                                {% if perms.DreamsApp.can_void_client and not client.voided  and current_user_belongs_to_same_ip_as_client %}
                                    {% if client.exited %}
                                        <p class="underline_hover exit_unexit_toggle" id="p_void_client"
                                           data-client_id='{{ client.id }}'
                                           style="cursor:pointer; display: none" data-toggle="modal"
                                           data-target="#client-void-modal"
                                           title="Void Client">
                                            <span class="glyphicon glyphicon-minus-sign"></span> Void Client
                                        </p>
                                    {% else %}
                                        <p class="underline_hover exit_unexit_toggle" id="p_void_client"
                                           data-client_id='{{ client.id }}'
                                           style="cursor:pointer;" data-toggle="modal" data-target="#client-void-modal"
                                           title="Void Client">
                                            <span class="glyphicon glyphicon-minus-sign"></span> Void Client
                                        </p>
                                    {% endif %}
                                {% endif %}
                            {% endif %}

                            </p>
                            {% if perms.DreamsApp.view_clientfollowup %}
                                <p class="underline_hover" data-client_id='{{ client.id }}' style="cursor:pointer;"
                                   onclick="window.location='/follow_ups?client_id={{ client.id }}'"
                                   data-toggle="tooltip" title="Follow Ups">
                                    <span class="glyphicon glyphicon-search"></span> Follow Ups
                                </p>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>

            <a class="no-hover" href="/clients?search_client_term={{ search_client_term }}"
               style="float: right;margin-bottom: 5px;margin-top: -5px;margin-right: 10px;"><span
                    class="glyphicon glyphicon-triangle-left"> </span> Back to Clients list</a>
            <div class="alert hidden dp-action-alert" id="action_alert_gen" role="alert"
                 style="margin-top: 15px;"></div>
            <!-- End of Client profile section -->
            <div class="dreams-profile-tab-control" id="dreams-enrollment-tab-control">
                <ul class="nav nav-tabs">
                    <li role="presentation"><a href="#demographics" aria-controls="demographics" role="tab"
                                               data-toggle="tab">Demographics</a>
                    </li>
                    <li role="presentation"><a href="#individual_and_household" aria-controls="individual_and_household"
                                               role="tab" data-toggle="tab">Individual
                        and Household</a></li>
                    <li role="presentation"><a href="#education_and_employment" aria-controls="education_and_employment"
                                               role="tab" data-toggle="tab">Education
                        and Employment</a></li>
                    <li role="presentation"><a href="#hiv_testing" aria-controls="hiv_testing" role="tab"
                                               data-toggle="tab"
                    >HIV Testing</a></li>
                    <li role="presentation"><a href="#sexuality" aria-controls="hiv_testing" role="tab"
                                               data-toggle="tab"
                    >Sexuality</a></li>
                    <li role="presentation"><a href="#reproductive_health" aria-controls="reproductive_health"
                                               role="tab"
                                               data-toggle="tab">Reproductive
                        Health</a></li>
                    <li role="presentation"><a href="#gbv" aria-controls="gbv" role="tab" data-toggle="tab"
                                               data-tab_table_id="#interventions_4001_table">GBV</a></li>
                    <li role="presentation"><a href="#drug_use" aria-controls="drug_use" role="tab" data-toggle="tab"
                    >Drug Use</a></li>
                    <li role="presentation"><a href="#participation_in_program" aria-controls="participation_in_program"
                                               role="tab" data-toggle="tab">Programs</a>
                    </li>
                </ul>
                <div id="results"></div>
                <div class="tab-content dp-tab-content">
                    <br/>
                    <div role="tabpanel" id="demographics" class="tab-pane fade in active client_profile_tab"
                         data-tabpanel_id="#demographics">
                        {% include 'client_demographics_form.html' %}
                    </div>

                    <div role="tabpanel" id="individual_and_household" class="tab-pane fade client_profile_tab"
                         data-tabpanel_id="#individual_and_household">
                        {% include 'client_individual_household_form.html' %}
                    </div>

                    <div role="tabpanel" id="education_and_employment" class="tab-pane fade client_profile_tab"
                         data-tabpanel_id="#education_and_employment">
                        {% include 'education_and_employment_form.html' %}
                    </div>

                    <div role="tabpanel" id="hiv_testing" class="tab-pane fade client_profile_tab"
                         data-tabpanel_id="#hiv_testing">
                        {% include 'client_hiv_testing_form.html' %}
                    </div>

                    <div role="tabpanel" id="sexuality" class="tab-pane fade client_profile_tab"
                         data-tabpanel_id="#sexuality">
                        {% include 'client_sexuality_form.html' %}
                    </div>
                    <div role="tabpanel" id="reproductive_health" class="tab-pane fade client_profile_tab"
                         data-tabpanel_id="#reproductive_health">
                        {% include 'client_reproductive_health_form.html' %}
                    </div>

                    <div role="tabpanel" id="gbv" class="tab-pane fade client_profile_tab" data-tabpanel_id="#gbv">
                        {% include 'client_gbv_form.html' %}
                    </div>

                    <div role="tabpanel" id="drug_use" class="tab-pane fade client_profile_tab"
                         data-tabpanel_id="#drug_use">
                        {% include 'client_drug_use_form.html' %}
                    </div>

                    <div role="tabpanel" id="participation_in_program" class="tab-pane fade client_profile_tab"
                         data-tabpanel_id="#participation_in_program">
                        {% include 'client_programme_participation_form.html' %}
                    </div>
                    <input id="current_client_id" class="hidden" type="text" value="{{ client.id }}">
                </div>
            </div>

            <br/>

            <script>
                baseonchange();
                frmdemographicsonsubmit() /* Default */

                $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                    var target = $(e.target).attr("href") // activated tab
                    var current_client_id = {{ client.id }};

                    if (target == "#individual_and_household") {
                        $.ajax({
                            type: "POST",
                            url: '/client_household_info',
                            data: {csrfmiddlewaretoken: '{{ csrf_token }}',
                                'client_id': current_client_id},
                            dataType: 'json',
                            success: function(result)
                            {
                                $('#individual_and_household').html(result.household_form);
                                individualhouseholdvalidate();
                                baseonchange();
                                frmhouseholdonsubmit();
                            },
                            error: function (xhr, errmsg, err) {
                                alert("error");
                            }
                        });
                    } else if (target == "#education_and_employment") {
                        $.ajax({
                            type: "POST",
                            url: '/education_employment_info',
                            data: {
                                csrfmiddlewaretoken: '{{ csrf_token }}',
                                'client_id': current_client_id
                            },
                            dataType: 'json',
                            success: function (result) {
                                $('#education_and_employment').html(result.edu_form);
                                educationemploymentvalidate();
                                baseonchange();
                                frmeducationemploymentonsubmit();
                            },
                            error: function (xhr, errmsg, err) {
                                alert("error");
                            }
                        });
                    } else if (target == "#hiv_testing") {
                        $.ajax({
                            type: "POST",
                            url: '/hiv_testing_info',
                            data: {
                                csrfmiddlewaretoken: '{{ csrf_token }}',
                                'client_id': current_client_id
                            },
                            dataType: 'json',
                            success: function (result) {
                                $('#hiv_testing').html(result.hiv_form);
                                hivtestingvalidate();
                                baseonchange();
                                frmhivtestingonsubmit();
                            },
                            error: function (xhr, errmsg, err) {
                                alert("error");
                            }
                        });
                    } else if (target == "#sexuality") {
                        $.ajax({
                            type: "POST",
                            url: '/sexuality_info',
                            data: {
                                csrfmiddlewaretoken: '{{ csrf_token }}',
                                'client_id': current_client_id
                            },
                            dataType: 'json',
                            success: function (result) {
                                $('#sexuality').html(result.sexuality_form);
                                sexualityvalidate();
                                baseonchange();
                                frmsexualityonsubmit();
                            },
                            error: function (xhr, errmsg, err) {
                                alert("error");
                            }
                        });
                    } else if (target == "#reproductive_health") {
                        $.ajax({
                            type: "POST",
                            url: '/reproductive_health_info',
                            data: {
                                csrfmiddlewaretoken: '{{ csrf_token }}',
                                'client_id': current_client_id
                            },
                            dataType: 'json',
                            success: function (result) {
                                $('#reproductive_health').html(result.rh_form);
                                frmreproductivehealthvalidate();
                                baseonchange();
                                frmreproductivehealthonsubmit();
                            },
                            error: function (xhr, errmsg, err) {
                                alert("error");
                            }
                        });
                    } else if (target == "#gbv") {
                        $.ajax({
                            type: "POST",
                            url: '/gbv_info',
                            data: {
                                csrfmiddlewaretoken: '{{ csrf_token }}',
                                'client_id': current_client_id
                            },
                            dataType: 'json',
                            success: function (result) {
                                $('#gbv').html(result.gbv_form);
                                gbvvalidate();
                                baseonchange();
                                frmgbvonsubmit();
                            },
                            error: function (xhr, errmsg, err) {
                                alert("error");
                            }
                        });
                    } else if (target == "#drug_use") {
                        $.ajax({
                            type: "POST",
                            url: '/drug_use_info',
                            data: {
                                csrfmiddlewaretoken: '{{ csrf_token }}',
                                'client_id': current_client_id
                            },
                            dataType: 'json',
                            success: function (result) {
                                $('#drug_use').html(result.drug_use_form);
                                drugusevalidate();
                                baseonchange();
                                frmdruguseonsubmit();
                            },
                            error: function (xhr, errmsg, err) {
                                alert("error");
                            }
                        });
                    } else if (target == "#participation_in_program") {
                        $.ajax({
                            type: "POST",
                            url: '/participation_in_program_info',
                            data: {
                                csrfmiddlewaretoken: '{{ csrf_token }}',
                                'client_id': current_client_id
                            },
                            dataType: 'json',
                            success: function (result) {
                                $('#participation_in_program').html(result.programe_participation_form);

                                baseonchange();
                                frmparticipationonsubmit();
                            },
                            error: function (xhr, errmsg, err) {
                                alert("error");
                            }
                        });
                    }

                });


                function concatWithSpace(stringArray) {
                    var concatString = '';
                    $.each(stringArray, function (index, stringVal) {
                        if (concatString != '')
                            concatString += " " + $.trim(stringVal)
                        else
                            concatString += $.trim(stringVal)
                    })
                    return concatString;
                }

                function frmdemographicsonsubmit() {
                    //Handle demographics tab
                    $('#form_demographics').on('submit', function (event) {
                        event.preventDefault()
                        if (!$(event.target).valid()) // Check if form is valid
                            return false;   // return, form is not valid
                        // enable disabled fields
                        var form = $('#form_demographics');
                        $('#demo_current_client_id').val($('#current_client_id').val());

                        $.ajax({
                            type: "POST",
                            url: form.attr('action'),
                            data: $(this).serialize(),
                            success: function (data) {
                                if (data.status == 'success') {
                                    var client_age = data.client_age;
                                    //$('#demo_replacement').replaceWith(data);
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-success')
                                        .text('saved successfully')
                                        .trigger('madeVisible')
                                    // Updating client details
                                    // Full name
                                    var clientFullName = concatWithSpace([$('#id_first_name').val(), $('#id_middle_name').val(), $('#id_last_name').val()])
                                    $('#shown_client_name').html(clientFullName);
                                    // Dreams id -- this can never change
                                    $('#shown_client_dob').html($('#id_date_of_birth').val())
                                    $('#shown_client_age').html(client_age)
                                    $('#shown_client_doe').html($('#id_date_of_enrollment').val())
                                    $('#shown_client_phone').html($('#id_phone_number').val())
                                    $('#shown_client_marital_status').html($('#id_marital_status option:selected').text())
                                } else {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-danger')
                                        .text('Could not save changes')
                                        .trigger('madeVisible')
                                }

                            },
                            error: function (xhr, errmsg, err) {
                                $('#action_alert_gen').removeClass('hidden').addClass('alert-danger')
                                    .text('Could not save changes')
                                    .trigger('madeVisible')
                            }
                        });
                    });
                }

                function frmhouseholdonsubmit() {
                    //Handle Individual and household tab
                    $('#form_ind_household').on('submit', function (event) {
                        event.preventDefault();
                        if (!$(event.target).valid()) // Check if form is valid
                            return false;

                        var form = $('#form_ind_household')
                        $.ajax({
                            type: "POST",
                            url: form.attr('action'),
                            data: $(this).serialize(),
                            success: function (data) {
                                //$('#household_replacement').replaceWith(data);
                                if (data.status == 'success') {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-success')
                                        .text('saved successfully')
                                        .trigger('madeVisible')
                                } else {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-danger').text('Could not save changes').trigger('madeVisible')
                                }
                            },
                            error: function (xhr, errmsg, err) {
                                alert(xhr.toString());
                                $('#action_alert_gen').removeClass('hidden').addClass('alert-danger')
                                    .text('Could not save changes')
                                    .trigger('madeVisible')
                            }
                        });
                    });
                }

                function frmeducationemploymentonsubmit() {
                    //Handle Education and employment tab
                    $('#form_edu_and_employment').on('submit', function (event) {
                        event.preventDefault();

                        if (!$(event.target).valid()) // Check if form is valid
                            return false;
                        var form = $('#form_edu_and_employment');
                        $.ajax({
                            type: "POST",
                            url: form.attr('action'),
                            data: $(this).serialize(),
                            success: function (data) {
                                if (data.status == 'success') {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-success')
                                        .text('saved successfully')
                                        .trigger('madeVisible')
                                } else {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-danger').text('Could not save changes').trigger('madeVisible')
                                }
                            },
                            error: function (xhr, errmsg, err) {
                                $('#action_alert_gen').removeClass('hidden').addClass('alert-danger')
                                    .text('Could not save changes')
                                    .trigger('madeVisible')
                            }
                        });
                    });
                }

                function frmhivtestingonsubmit() {
                    //Handle HIV Testing tab
                    $('#form_hiv_testing').on('submit', function (event) {
                        event.preventDefault();

                        if (!$(event.target).valid()) // Check if form is valid
                            return false;
                        var form = $('#form_hiv_testing');

                        $.ajax({
                            type: "POST",
                            url: form.attr('action'),
                            data: $(this).serialize(),
                            success: function (data) {
                                if (data.status == 'success') {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-success')
                                        .text('saved successfully')
                                        .trigger('madeVisible')
                                } else {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-danger').text('Could not save changes').trigger('madeVisible')
                                }
                            },
                            error: function (xhr, errmsg, err) {
                                $('#action_alert_gen').removeClass('hidden').addClass('alert-danger')
                                    .text('Could not save changes')
                                    .trigger('madeVisible')
                            }
                        });
                    });
                }

                function frmsexualityonsubmit() {
                    //Handle Sexuality Tab
                    $('#form_sexuality').on('submit', function (event) {
                        event.preventDefault();

                        if (!$(event.target).valid()) // Check if form is valid
                            return false;

                        var form = $('#form_sexuality');
                        $.ajax({
                            type: "POST",
                            url: form.attr('action'),
                            data: $(this).serialize(),
                            success: function (data) {
                                if (data.status == 'success') {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-success')
                                        .text('saved successfully')
                                        .trigger('madeVisible')
                                } else {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-danger').text('Could not save changes').trigger('madeVisible')
                                }
                            },
                            error: function (xhr, errmsg, err) {
                                $('#action_alert_gen').removeClass('hidden').addClass('alert-danger')
                                    .text('Could not save changes')
                                    .trigger('madeVisible')
                            }
                        });
                    });
                }

                function frmreproductivehealthonsubmit() {
                    //Handle Reproductive Health Tab
                    $('#form_rep_health').on('submit', function (event) {
                        event.preventDefault();

                        if (!$(event.target).valid()) // Check if form is valid
                            return false;
                        var form = $('#form_rep_health');
                        $.ajax({
                            type: "POST",
                            url: form.attr('action'),
                            data: $(this).serialize(),
                            success: function (data) {
                                if (data.status == 'success') {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-success')
                                        .text('saved successfully')
                                        .trigger('madeVisible')
                                } else {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-danger').text('Could not save changes').trigger('madeVisible')
                                }
                            },
                            error: function (xhr, errmsg, err) {
                                $('#action_alert_gen').removeClass('hidden').addClass('alert-danger')
                                    .text('Could not save changes')
                                    .trigger('madeVisible')
                            }
                        });
                    });
                }

                function frmgbvonsubmit() {
                    //Handle GBV Tab
                    $('#form_gbv').on('submit', function (event) {
                        event.preventDefault();

                        if (!$(event.target).valid()) // Check if form is valid
                            return false;

                        var form = $('#form_gbv');
                        $.ajax({
                            type: "POST",
                            url: form.attr('action'),
                            data: $(this).serialize(),
                            success: function (data) {
                                if (data.status == 'success') {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-success')
                                        .text('saved successfully')
                                        .trigger('madeVisible')
                                } else {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-danger').text('Could not save changes').trigger('madeVisible')
                                }
                            },
                            error: function (xhr, errmsg, err) {
                                $('#action_alert_gen').removeClass('hidden').addClass('alert-danger')
                                    .text('Could not save changes')
                                    .trigger('madeVisible')
                            }
                        });
                    });
                }

                function frmdruguseonsubmit() {
                    //Handle Drug Use tab
                    $('#form_drug_use').on('submit', function (event) {
                        event.preventDefault();

                        if (!$(event.target).valid()) // Check if form is valid
                            return false;

                        var form = $('#form_drug_use');
                        $.ajax({
                            type: "POST",
                            url: form.attr('action'),
                            data: $(this).serialize(),
                            success: function (data) {
                                if (data.status == 'success') {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-success')
                                        .text('saved successfully')
                                        .trigger('madeVisible')
                                } else {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-danger').text('Could not save changes').trigger('madeVisible')
                                }
                            },
                            error: function (xhr, errmsg, err) {
                                $('#action_alert_gen').removeClass('hidden').addClass('alert-danger')
                                    .text('Could not save changes')
                                    .trigger('madeVisible')
                            }
                        });
                    });
                }

                function frmparticipationonsubmit() {
                    //Handle Participation in programmes tab
                    $('#form_programme_participation').on('submit', function (event) {
                        event.preventDefault();

                        if (!$(event.target).valid()) // Check if form is valid
                            return false;

                        var form = $('#form_programme_participation');
                        $.ajax({
                            type: "POST",
                            url: form.attr('action'),
                            data: $(this).serialize(),
                            success: function (data) {
                                if (data.status == 'success') {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-success')
                                        .text('saved successfully')
                                        .trigger('madeVisible')
                                } else {
                                    $('#action_alert_gen').removeClass('hidden').addClass('alert-danger').text('Could not save changes').trigger('madeVisible')
                                }
                            },
                            error: function (xhr, errmsg, err) {
                                $('#action_alert_gen').removeClass('hidden').addClass('alert-danger')
                                    .text('Could not save changes')
                                    .trigger('madeVisible')
                            }
                        });
                    });
                }

                function individualhouseholdvalidate() {
                    $("#form_ind_household").validate({
                        rules: {
                            head_of_household: {
                                required: true
                            },
                            head_of_household_other: {
                                requiredIfHeadOfHouseholdIsOtherSpecify: true
                            },
                            age_of_household_head: {
                                number: true,
                                positiveNumberZeroExclusive: true
                            },
                            is_father_alive: {
                                required: true
                            },
                            is_mother_alive: {
                                required: true
                            },
                            is_parent_chronically_ill: {
                                required: true
                            },
                            main_floor_material: {
                                required: true
                            },
                            main_roof_material: {
                                required: true
                            },
                            main_wall_material: {
                                required: true
                            },
                            source_of_drinking_water: {
                                required: true
                            },
                            ever_missed_full_day_food_in_4wks: {
                                required: true
                            },
                            has_disability: {
                                required: true
                            },
                            no_of_people_in_household: {
                                required: true,
                                number: true,
                                positiveNumber: true
                            },
                            no_of_females: {
                                required: true,
                                number: true,
                                positiveNumber: true
                            },
                            no_of_males: {
                                required: true,
                                number: true,
                                positiveNumber: true,
                                matchingGenderDisaggregatedCount: true
                            },
                            no_of_adults: {
                                required: true,
                                number: true,
                                positiveNumber: true
                            },
                            no_of_children: {
                                required: true,
                                number: true,
                                positiveNumber: true,
                                matchingAgeDisaggregatedCount: true
                            },
                            ever_enrolled_in_ct_program: {
                                required: true
                            }
                        },
                        messages: {
                            head_of_household: {
                                required: " * Please Select Head of Household"
                            },
                            head_of_household_other: {
                                requiredIfHeadOfHouseholdIsOtherSpecify: "* Please Specify household head"
                            },
                            age_of_household_head: {
                                number: " Enter valid age e.g 45"
                            },
                            is_father_alive: {
                                required: " * Required field"
                            },
                            is_mother_alive: {
                                required: " * Required field"
                            },
                            is_parent_chronically_ill: {
                                required: " * Required field"
                            },
                            main_floor_material: {
                                required: " * Required field"
                            },
                            main_roof_material: {
                                required: " * Required field"
                            },
                            main_wall_material: {
                                required: " * Required field"
                            },
                            source_of_drinking_water: {
                                required: " * Required field"
                            },
                            ever_missed_full_day_food_in_4wks: {
                                required: " * Required field"
                            },
                            has_disability: {
                                required: " * Required field"
                            },
                            no_of_people_in_household: {
                                required: " * Required field",
                                number: " Enter valid number e.g 5"
                            },
                            no_of_females: {
                                required: " * Required field",
                                number: " Enter valid number e.g 5"
                            },
                            no_of_males: {
                                required: " * Required field",
                                number: " Enter valid number e.g 5",
                                matchingGenderDisaggregatedCount: " Number of females and males in household do not add up."
                            },
                            no_of_adults: {
                                required: " * Required field",
                                number: " Enter valid number e.g 5"
                            },
                            no_of_children: {
                                required: " * Required field",
                                number: " Enter valid number e.g 5",
                                matchingAgeDisaggregatedCount: " Number of adults and children in household do not add up."
                            },
                            ever_enrolled_in_ct_program: {
                                required: " * Required field"
                            }
                        },
                        highlight: function (element) {
                            $('#form_ind_household .error').addClass('text-danger')
                        },
                        unhighlight: function (element) {
                            $('#form_ind_household').find('.error').removeClass('text-danger')
                        }
                    });
                }


                function educationemploymentvalidate() {
                    $("#form_edu_and_employment").validate({
                        rules: {
                            currently_in_school: {
                                required: true
                            },
                            has_savings: {
                                required: true
                            }
                        },
                        messages: {
                            currently_in_school: {
                                required: " * Please Select Head of Household"
                            },
                            has_savings: {
                                required: " * Required field"
                            }
                        },
                        highlight: function (element) {
                            $('#form_edu_and_employment .error').addClass('text-danger')
                        },
                        unhighlight: function (element) {
                            $('#form_edu_and_employment').find('.error').removeClass('text-danger')
                        }
                    });
                }

                function hivtestingvalidate() {
                    $("#form_hiv_testing").validate({
                        rules: {
                            ever_tested_for_hiv: {
                                required: true
                            }
                        },
                        messages: {
                            ever_tested_for_hiv: {
                                required: " * Required field"
                            }
                        },
                        highlight: function (element) {
                            $('#form_hiv_testing .error').addClass('text-danger')
                        },
                        unhighlight: function (element) {
                            $('#form_hiv_testing').find('.error').removeClass('text-danger')
                        }
                    });

                    $.validator.addMethod('requiredPositiveIfHasCurrentSexualPartnerElseZero', function (value) {
                        var isEntered = false;
                        var sexualPartnersInLast12Months = 0;
                        if (value != "")
                            sexualPartnersInLast12Months = parseInt(value, 10) || 0;
                        isEntered = true;
                        var has_sexual_partner = parseInt($('#id_has_sexual_partner').val(), 10) || 0;
                        if (has_sexual_partner == 1 && (!isEntered || (sexualPartnersInLast12Months == 0)))
                            return false;
                        return true;
                    }, ' ');
                }

                function sexualityvalidate() {
                    $("#form_sexuality").validate({
                        rules: {
                            ever_had_sex: {
                                required: true
                            },
                            age_at_first_sexual_encounter: {
                                requiredIfEverHadSex: true,
                                positiveNumberZeroExclusive: true
                            },
                            has_sexual_partner: {
                                requiredIfEverHadSex: true
                            },
                            sex_partners_in_last_12months: {
                                requiredIfEverHadSex: true,
                                requiredPositiveIfHasCurrentSexualPartnerElseZero: true
                            }
                        },
                        messages: {
                            ever_had_sex: {
                                required: " * Required field"
                            },
                            age_at_first_sexual_encounter: {
                                requiredIfEverHadSex: " * Required field",
                                positiveNumberZeroExclusive: "Enter a positive number greater than 0."
                            },
                            has_sexual_partner: {
                                positiveNumber: " Enter positive number e.g 0,1,2...",
                                requiredIfEverHadSex: "* Required field"
                            },
                            sex_partners_in_last_12months: {
                                requiredIfEverHadSex: " * Required field",
                                requiredPositiveIfHasCurrentSexualPartnerElseZero: " * Number of sex partners should be greater than Zero"
                            }
                        },
                        highlight: function (element) {
                            $('#form_sexuality .error').addClass('text-danger')
                        },
                        unhighlight: function (element) {
                            $('#form_sexuality').find('.error').removeClass('text-danger')
                        }
                    });
                }

                function frmreproductivehealthvalidate() {
                    $("#form_rep_health").validate({
                        rules: {
                            fp_methods_awareness: {
                                required: true
                            },
                            no_of_biological_children: {
                                positiveNumber: true,
                                requiresChildren: true
                            },
                            currently_pregnant: {
                                required: true
                            },
                            known_fp_method: {
                                required: true
                            },
                            currently_use_modern_fp: {
                                required: true
                            }
                        },
                        messages: {
                            fp_methods_awareness: {
                                required: " * Required field"
                            },
                            no_of_biological_children: {
                                requiresChildren: "Number of biological children required."
                            },
                            currently_pregnant: {
                                required: "* Required field"
                            },
                            known_fp_method: {
                                required: "* Required field"
                            },
                            currently_use_modern_fp: {
                                required: "* Required field"
                            }
                        },
                        highlight: function (element) {
                            $('#form_rep_health .error').addClass('text-danger')
                        },
                        unhighlight: function (element) {
                            $('#form_rep_health').find('.error').removeClass('text-danger')
                        }
                    });
                }

                function gbvvalidate() {
                    $("#form_gbv").validate({
                        rules: {
                            humiliated_ever: {
                                required: true
                            },
                            threats_to_hurt_ever: {
                                required: true
                            },
                            insulted_ever: {
                                required: true
                            },
                            economic_threat_ever: {
                                required: true
                            },
                            physical_violence_ever: {
                                required: true
                            },
                            physically_forced_sex_ever: {
                                required: true
                            },
                            physically_forced_other_sex_acts_ever: {
                                required: true
                            },
                            threatened_for_sexual_acts_ever: {
                                required: true
                            }
                        },
                        messages: {
                            humiliated_ever: {
                                required: " * Required field"
                            },
                            threats_to_hurt_ever: {
                                required: " * Required field"
                            },
                            insulted_ever: {
                                required: " * Required field"
                            },
                            economic_threat_ever: {
                                required: " * Required field"
                            },
                            physical_violence_ever: {
                                required: " * Required field"
                            },
                            physically_forced_sex_ever: {
                                required: " * Required field"
                            },
                            physically_forced_other_sex_acts_ever: {
                                required: " * Required field"
                            },
                            threatened_for_sexual_acts_ever: {
                                required: " * Required field"
                            }
                        },
                        highlight: function (element) {
                            $('#form_gbv .error').addClass('text-danger')
                        },
                        unhighlight: function (element) {
                            $('#form_gbv').find('.error').removeClass('text-danger')
                        }
                    });
                }

                function drugusevalidate() {
                    $("#form_drug_use").validate({
                        rules: {
                            used_alcohol_last_12months: {
                                required: true
                            },
                            drug_abuse_last_12months: {
                                required: true
                            },
                            produced_alcohol_last_12months: {
                                required: true
                            }
                        },
                        messages: {
                            used_alcohol_last_12months: {
                                required: " * Required field"
                            },
                            drug_abuse_last_12months: {
                                required: " * Required field"
                            },
                            produced_alcohol_last_12months: {
                                required: " * Required field"
                            }
                        },
                        highlight: function (element) {
                            $('#form_drug_use .error').addClass('text-danger')
                        },
                        unhighlight: function (element) {
                            $('#form_drug_use').find('.error').removeClass('text-danger')
                        }
                    });
                }


                function baseonchange() {
                    $('.listen-to-change').on('change keyup', function () {
                        var val = $(this).val();
                        var show_if_true = $(this).data('show_if_true'); // class to show
                        var hide_if_true = $(this).data('hide_if_true'); // class to show
                        var hide_if_false = $(this).data('hide_if_false'); // class to hide
                        var show_value = $(this).data('show_value'); // value to determine show/hide

                        if (!(typeof hide_if_false == undefined) && hide_if_false != null && hide_if_false != '') {
                            var hide_classes = hide_if_false.split(" ");
                            hide_if_false = hide_classes;
                        }

                        if (!(typeof hide_if_true == undefined) && hide_if_true != null && hide_if_true != '') {
                            var hide_on_show_classes = hide_if_true.split(" ");
                            hide_if_true = hide_on_show_classes;
                        }

                        if (val == show_value || show_value == 'any') {
                            $('.' + show_if_true).removeClass('hidden');

                            if (!(typeof hide_if_true == undefined) && hide_if_true != null && hide_if_true != '') {
                                for (var i = 0; i < hide_if_true.length; i++) {
                                    var class_name = hide_if_true[i];
                                    $('.' + class_name).addClass('hidden');
                                    $('.' + class_name).find('input,select').each(function () {
                                        $(this).val('');
                                        $(this).attr('checked', false);
                                    });
                                }
                            }
                        } else {
                            $('.' + show_if_true).addClass('hidden');

                            $('.' + show_if_true).find('input,select').each(function () {
                                $(this).val('');
                                $(this).attr('checked', false);
                            });

                            if (!(typeof hide_if_false == undefined) && hide_if_false != null && hide_if_false != '') {
                                for (var i = 0; i < hide_if_false.length; i++) {
                                    var class_name = hide_if_false[i];
                                    $('.' + class_name).addClass('hidden');
                                    $('.' + class_name).find('input,select').each(function () {
                                        $(this).val('');
                                        $(this).attr('checked', false);
                                    });
                                }
                            }

                            if (!(typeof hide_if_true == undefined) && hide_if_true != null && hide_if_true != '') {
                                for (var i = 0; i < hide_if_true.length; i++) {
                                    var class_name = hide_if_true[i];
                                    $('.' + class_name).removeClass('hidden');
                                }
                            }
                        }
                    });

                    $('.multi-select').on('change', function () {
                        var selected = $(this).val();
                        var show_value = $(this).data('show_value');
                        var show_if_true = $(this).data('show_if_true');

                        for (var i = 0; i < selected.length; i++) {
                            if (selected[i] == show_value) {
                                $('.' + show_if_true).removeClass('hidden');
                            } else {
                                $('.' + show_if_true).addClass('hidden');
                            }
                        }
                        console.log(selected);
                    });

                    $('.if-not-listener').on('change', function () {
                        var selected = $(this).val();
                        var if_not_value = $(this).data('if_not_value');
                        var if_not_show_class = $(this).data('if_not_show_class');

                        if (selected == if_not_value) {
                            $('.' + if_not_show_class).addClass('hidden');
                        } else {
                            $('.' + if_not_show_class).removeClass('hidden');
                        }
                    });

                    $('.multi-value-listener').on('change', function () {

                        var selected = $(this).val();
                        var group_value = $(this).data('group_value');
                        var group_get_value_class = $(this).data('group_get_value_class');
                        var group_show_class = $(this).data('group_show_class');
                        var group_hide_class = $(this).data('group_hide_class');
                        var result = false;
                        $('.' + group_get_value_class + ' :selected').each(function () {
                            if ($(this).val() == 1) {
                                result = true;
                                return false;
                            }
                        });

                        if (result) {
                            $('.' + group_show_class).removeClass('hidden');
                            $('.' + group_hide_class).addClass('hidden');
                        } else {
                            $('.' + group_show_class).addClass('hidden');
                            $('.' + group_hide_class).removeClass('hidden');
                        }
                    });

                    $('.sexual-partner-info').on('change keyup', function () {
                        var value = parseInt($(this).val().trim());
                        $('.third-last-partner, .second-last-partner, .last-partner').addClass('hidden');
                        switch (true) {
                            case (value == 1):
                                $('.last-partner').removeClass('hidden');
                                $('.sexual-partners').removeClass('hidden');
                                break;
                            case (value == 2):
                                $('.second-last-partner, .last-partner').removeClass('hidden');
                                $('.sexual-partners').removeClass('hidden');
                                break;
                            case (value > 2):
                                $('.third-last-partner, .second-last-partner, .last-partner').removeClass('hidden');
                                $('.sexual-partners').removeClass('hidden');
                                break;
                            default:
                                $('.third-last-partner, .second-last-partner, .last-partner').addClass('hidden');
                                $('.sexual-partners').addClass('hidden');
                        }
                    });
                }


                function skip_pattern(target_element, target_value, element_list_to_manipulate, hide_class) {
                    var option = $('#' + target_element).val();
                    console.log(option + ' against: ' + target_value);
                    if (option == target_value) {
                        for (var i = 0; i < element_list_to_manipulate.length; i++) {
                            console.log(element_list_to_manipulate[i])
                            $('#' + element_list_to_manipulate[i]).removeClass(hide_class);
                        }
                    } else {
                        for (var i = 0; i < element_list_to_manipulate.length; i++) {
                            console.log(element_list_to_manipulate[i])
                            $('#' + element_list_to_manipulate[i]).addClass(hide_class);
                        }
                    }
                }
            </script>
        </div>
    {% endif %}
{% endblock %}