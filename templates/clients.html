{% extends 'base.html' %}
{% load staticfiles %}

{% block content %}

    <!-- Beginning Enrollment modal-->
        <!-- Modal -->
    <div class="modal fade" id="enrollment-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         xmlns="http://www.w3.org/1999/html">
        <form id="enrollment-form" class="form-horizontal">
        {% csrf_token %}
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">CLIENT ENROLLMENT</h4>
                </div>
              <div class="modal-body">
                    <!-- Permanently hidden Fields -->
                    <input class="hidden" name="client_id" id="client_id"/>
                    <!-- End of permanently hidden fields -->

                    <div class="form-group">
                         <label for="middle_name" class="control-label">First Name</label>
                         <input type="text" class="form-control" id="first_name" name="first_name" >
                         <span id="spn_first_name"></span>
                     </div>

                     <div class="form-group">
                         <label for="middle_name" class="control-label">Middle Name</label>
                         <input type="text" class="form-control" id="middle_name" name="middle_name" >
                         <span id="spn_middle_name"></span>
                     </div>

                     <div class="form-group">
                         <label for="last_name" class="control-label">Last Name</label>
                         <input type="text" class="form-control validate_field" id="last_name" name="last_name" >
                         <span id="spn_last_name"></span>
                     </div>

                     <div class="form-group has-feedback">
                         <label for="date_of_birth" class="control-label">Date of Birth:</label>
                         <input type="text" class="form-control" id="date_of_birth" name="date_of_birth" placeholder="Select date of birth" style="cursor: pointer;"><span class="add-on"><i class="icon-th"></i></span></p>
                         <i class="glyphicon glyphicon-calendar form-control-feedback"></i>
                         <script>
                            $(function() {
                              $( "#date_of_birth" ).datepicker({
                                  dateFormat: 'yy-mm-dd'
                              });
                            });
                            {% if client != None %}
                                setTimeout(function () {
                                    /*var parsed_date = Date.parse("{{ client.date_of_birth }}");
                                    var date_object = new Date(parsed_date);
                                    var formatted_date = date_object.getFullYear() + '-' + date_object.getMonth() + '-' + date_object.getDate();
                                    $( "#date_of_birth" ).datepicker( "setDate", formatted_date );*/
                                }, 1000);
                            {% endif %}
                        </script>
                         <span id="spn_date_of_birth"></span>
                     </div>

                     <div class="checkbox">
                        <label>
                          <input type="checkbox" id="is_date_of_birth_estimated" name="is_date_of_birth_estimated"> Date of Birth Estimated
                        </label>
                     </div>

                     <div class="form-group">
                         <label for="verification_doc_no" class="control-label">Verification Doc. No.</label>
                         <input type="text" class="form-control validate_field required_field" id="verification_doc_no" name="verification_doc_no" >
                         <span id="spn_verification_doc_no"></span>
                     </div>

                     <div class="form-group has-feedback">
                         <label for="date_of_enrollment" class="control-label">Date of Enrollment:</label>
                         <input type="text" class="form-control format_date_event" name="date_of_enrollment" id="date_of_enrollment" placeholder="Select date of Enrollment" style="cursor: pointer;"><span class="add-on"><i class="icon-th"></i></span></p>
                         <i class="glyphicon glyphicon-calendar form-control-feedback"></i>
                         <script>
                            $(function() {
                              $( "#date_of_enrollment").datepicker({
                                  dateFormat: 'yy-mm-dd',
                                  maxDate: '+0m +0d'
                              });
                            });
                            {% if client != None %}
                                setTimeout(function () {
                                    /*var parsed_date = Date.parse("{{ client.date_of_enrollment }}");
                                    var date_object = new Date(parsed_date);
                                    var formatted_date = date_object.getFullYear() + '-' + date_object.getMonth() + '-' + date_object.getDate();
                                    $( "#date_of_enrollment" ).datepicker( "setDate", formatted_date );*/
                                }, 1000);

                            {% endif %}

                        </script>
                         <span id="spn_date_of_enrollment"></span>
                     </div>

                     <div class="form-group">
                         <label for="aget_at_enrollment" class="control-label">Age at Enrollment</label>
                         <input type="text" class="form-control validate_field required_field" id="age_at_enrollment" name="age_at_enrollment" >
                         <span id="spn_age_at_enrollment"></span>
                     </div>

                     <div class="form-group">
                        <label for="marital_status">Marital Status</label>
                        <select id="marital_status" name="marital_status" class="form-control validate_field" >
                            <option value="">Select Option</option>
                            <option value="401">Single</option>
                            <option value="402">Married/Cohabiting</option>
                            <option value="403">Separated/Divorced</option>
                            <option value="404">Widowed</option>
                        </select>
                         <span id="spn_marital_status"></span>
                    </div>

                     <div class="form-group">
                         <label for="phone_number" class="control-label">Phone Number</label>
                         <input type="text" class="form-control validate_field phone_number_field" id="phone_number" name="phone_number">
                         <span id="spn_phone_number"></span>
                     </div>

                     <div class="form-group">
                         <label for="dss_id_number" class="control-label">DSS ID Number (If applicable)</label>
                         <input type="text" class="form-control" id="dss_id_number" name="dss_id_number">
                         <span id="spn_dss_id_number"></span>
                     </div>

                     <div class="form-group">
                        <label for="county_of_residence">County of Residence</label>
                        <select id="county_of_residence" name="county_of_residence" class="form-control validate_field">
                            <option value="">Select Option</option>
                            <option value="NBI">Nairobi</option>
                           <!-- <option value="KSM">Kisumu</option>
                            <option value="HBY">Homa Bay</option>
                            <option value="SYA">Siaya</option>-->
                        </select>
                         <span id="spn_county_of_residence"></span>
                    </div>

                     <div class="form-group">
                        <label for="sub_county">Sub-County</label>
                        <select id="sub_county" name="sub_county" class="form-control validate_field" >
                            <option value="">Select Option</option>
                            <option value="NBI008">Westlands</option>
                           <option value="NBI007">Langata</option>
                            <option value="NBI006">Dagoretti</option>
                            <option value="NBI005">Njiru</option>
                           <option value="NBI004">Embakasi</option>
                            <option value="NBI003">Makadara</option>
                            <option value="NBI002">Kasarani</option>
                            <option value="NBI001">Kamukunji</option>
                        </select>
                         <span id="spn_sub_county"></span>
                     </div>

                     <div class="form-group">
                        <label for="ward">Ward</label>
                        <select id="ward" name="ward" class="form-control validate_field" >
                            <option value="">Select Option</option>
                        </select>
                         <span id="spn_ward"></span>
                     </div>

                     <div class="form-group">
                         <label for="informal_settlement" class="control-label">Informal Settlement</label>
                         <input type="text" class="form-control" id="informal_settlement" name="informal_settlement" >
                         <span id="spn_informal_settlement"></span>
                     </div>

                     <div class="form-group">
                         <label for="village" class="control-label">Village</label>
                         <input type="text" class="form-control" id="village" name="village" >
                         <span id="spn_village"></span>
                     </div>

                     <div class="form-group">
                         <label for="landmark" class="control-label">Land mark near residence</label>
                         <input type="text" class="form-control" id="landmark" name="landmark">
                         <span id="spn_landmark"></span>
                     </div>

                     <div class="form-group">
                         <label for="dreams_id" class="control-label">DREAMS ID Number</label>
                         <input type="text" class="form-control validate_field required_field" id="dreams_id" name="dreams_id">
                         <span id="spn_dreams_id"></span>
                     </div>

                     <div class="form-group">
                         <label for="guardian_name" class="control-label">Primary care giver /Guardianâ€™s Name</label>
                         <input type="text" class="form-control" id="guardian_name" name="guardian_name">
                         <span id="spn_guardian_name"></span>
                     </div>

                     <div class="form-group">
                         <label for="relationship_with_guardian" class="control-label">Relationship</label>
                         <input type="text" class="form-control" id="relationship_with_guardian" name="relationship_with_guardian" >
                         <span id="spn_relationship_with_guardian"></span>
                     </div>

                     <div class="form-group">
                         <label for="guardian_phone_number" class="control-label">Phone number (Care giver /Guardian)</label>
                         <input type="text" class="form-control validate_field phone_number_field" id="guardian_phone_number" name="guardian_phone_number">
                         <span id="spn_guardian_phone_number"></span>
                     </div>

                     <div class="form-group">
                         <label for="guardian_national_id" class="control-label">National ID (Care giver/Guardian)</label>
                         <input type="text" class="form-control" id="guardian_national_id" name="guardian_national_id">
                         <span id="spn_guardian_national_id"></span>
                     </div>

              </div>
              <div class="modal-footer">
                <button id="btn_cancel_intervention" type="button" class="btn btn-default" data-dismiss="modal"> Cancel </button>
                <button id="btn_save_enrollment" type="submit" class="btn btn-primary" > Save Enrollment </button>
              </div>
            </div>
          </div>
    </form>
    </div>
    <!-- End Enrollment modal-->

    <div class="row search-section">

        <form id="clients_search_form" method="post">
            {% csrf_token %}
            <table class="fit-item space" >
              <thead>
                  <tr>
                      <th style="padding-right: 10px;">
                          <div class="input-group">
                              <span id="sumbitDefaultNameSearch" onclick="$(this).submit();" class="input-group-addon btn btn-primary" style="color: #FFFFFF;" >Filter</span>
                             <input id="search-term-default" type="text" name="searchValue" class="form-control" placeholder="Search for client by Name or DREAMS ID" >
                          </div>
                      </th>
                      <th><button class="btn btn-default" data-toggle="modal" data-target="#enrollment-modal" ><i class="glyphicon glyphicon-plus text-success"></i> New Enrollment</button></th>
                  </tr>
              </thead>
             </table>
        </form>
    </div>

    <div class="row alert hidden dp-action-alert" id="client_actions_alert" role="alert"></div>

    <div class="panel panel-default" style="padding-left: 0px; margin-left: 0px;">
            <div class="panel-body" style="margin: 0px;padding: 0px;">
                <table class="table table-striped dp-patient-table" id="dp-patient-list">
                    <thead>
                      <th>DREAMS ID</th>
                        <th>Name</th>
                        <th>Date of Enrollment</th>
                        <th>Actions</th>
                    </thead>
                    <tbody id="dp-patient-list-body">
                        {% for client in clients %}
                        <tr id="clients_row_{{ client.id }}" style="cursor: pointer;">
                            <td>{{ client.id}}</td>
                            <td>{{ client.first_name }} {{ client.last_name }} {{ client.middle_name }}</td>
                            <td>{{ client.date_of_birth }}</td>
                            <td id="client_" + {{ client.id }}>
                                <span class='glyphicon glyphicon-pencil view_intervention_click' aria-hidden="true" onclick="window.location='/client?client_id={{ client.id }}' " style="cursor: pointer;">Interventions</span>
                                {% if user.is_superuser %}
                                &nbsp; &nbsp; &nbsp; &nbsp;
                                <span class='glyphicon glyphicon-pencil edit_intervention_click' arial-label='Arial-Hidden' data-toggle="modal" data-target="#enrollment-modal" data-client_id='{{ client.id }}' data-client="JSON.stringify({{ client }});" style="cursor: pointer;word-spacing: 0px !important;">Edit Enrollment</span>
                                &nbsp;&nbsp;
                                <span class='glyphicon glyphicon-trash delete_intervention_click delete_client' data-client_id='{{ client.id }}' arial-label='Arial-Hidden'>Delete Enrollment</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
    </div>

{% endblock %}